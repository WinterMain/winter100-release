<!DOCTYPE html><html  data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>实时将HTTP流传输到HTML5视频客户端的最佳方法 - Winter100</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KZ1S1HBYLX"></script>
<link rel="stylesheet" type="text/css" href="/iconfont/iconfont.css?t=20240930">
<link rel="stylesheet" href="/_nuxt/entry.DrNe-4ui.css">
<link rel="stylesheet" href="/_nuxt/default.IGDD3AF_.css">
<link rel="stylesheet" href="/_nuxt/el-popper.K902zei-.css">
<link rel="stylesheet" href="/_nuxt/Donate.C61dBJSg.css">
<link rel="stylesheet" href="/_nuxt/Adsense.BGfBUczI.css">
<link rel="stylesheet" href="/_nuxt/Main.DNckYZCw.css">
<link rel="stylesheet" href="/_nuxt/Discuss.DCbqPIzI.css">
<link rel="stylesheet" href="/_nuxt/NewList.B56uyASM.css">
<link rel="stylesheet" href="/_nuxt/all.BFkK1imR.css">
<link rel="preload" as="fetch" crossorigin="anonymous" href="/question/2856/_payload.json?47ab0edb-15e7-4bcc-8c17-4ee0b46c6aa8">
<script src="/_nuxt/xuoSwgeJ-legacy.js" nomodule crossorigin></script>
<script src="/_nuxt/DT-7pVnt-legacy.js" nomodule crossorigin></script>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-KZ1S1HBYLX');
</script>
<meta property="og:title" content="实时将HTTP流传输到HTML5视频客户端的最佳方法 - Winter100">
<meta name="description" content="我真的很想了解使用node.js将ffmpeg实时输出流到HTML5客户端的最佳方法，因为有很多变量在起作用，而且我在这个领域没有很多经验，花了很多小时尝...">
<meta property="og:description" content="我真的很想了解使用node.js将ffmpeg实时输出流到HTML5客户端的最佳方法，因为有很多变量在起作用，而且我在这个领域没有很多经验，花了很多小时尝...">
<meta property="og:image" content>
<meta name="twitter:card" content="summary_large_image">
<script type="module" src="/_nuxt/DqBY2TGQ.js" crossorigin></script></head><body><div id="el-popper-container-1024"><!--teleport start anchor--><!--[--><div style="z-index:2001;position:absolute;left:0;top:0;width:120px;display:none;" class="el-popper is-light el-popover c-lang-legal-popover" tabindex="-1" aria-hidden="true"><!--[--><!--[--><!--[--><!--[--><!--v-if--><!--[--><div class="c-lang-legal-box"><div class="c-contain"><ul class="c-list"><!--[--><li class="item-list list-item-active"><img src="/images/cn.svg" class="mr-12"><div class="flex-shrink-0">简体中文</div></li><li class="item-list false"><img src="/images/cn.svg" class="mr-12"><div class="flex-shrink-0">繁体中文</div></li><li class="item-list false"><img src="/images/en.svg" class="mr-12"><div class="flex-shrink-0">English</div></li><!--]--></ul></div></div><!--]--><!--]--><span class="el-popper__arrow" style="position:absolute;" data-popper-arrow></span><!--]--><!--]--><!--]--></div><!--]--><!--teleport anchor--><!--teleport start anchor--><!--[--><!--v-if--><!--]--><!--teleport anchor--><!--teleport start anchor--><!--[--><!--v-if--><!--]--><!--teleport anchor--></div><div id="__nuxt"><!--[--><section class="el-container is-vertical l-home"><!--[--><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><!--[--><!----><!--]--><!--[--><!----><!--]--><div class="c-common-header"><header class="el-header c-common-header-inner" style=""><!--[--><a href="/" class="flex space-x-8 items-center"><div class="sub-logo"><svg t="1696732448231" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6740" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><defs><linearGradient id="left-to-right"><stop offset="0" stop-color="#ed3da1"><animate dur="3s" attributeName="offset" fill="freeze" values="-1;2;0" repeatCount="indefinite"></animate></stop><stop offset="0" stop-color="#ffe9f6"><animate dur="3s" attributeName="offset" fill="freeze" values="-1;2;0" repeatCount="indefinite"></animate></stop></linearGradient></defs><path d="M105.321374 914.265136c-11.700669 0-17.551004-11.702475-17.551003-17.541972 0-5.870203 5.850335-17.551004 11.7097-17.551004 269.155125-111.194286 561.722425-169.684988 848.441196-181.3983v5.839497c23.410369 0 52.662042-5.839497 76.076024-5.839497v11.711506c-292.558269 29.251673-579.284266 87.756824-854.300562 175.535323-17.551004 17.541972-40.964985 23.403144-64.375355 29.244447zM772.382332 580.741882c-29.260704 0-58.514183-5.861172-76.054349-29.240835-17.55281-23.412175-35.123682-46.826157-35.123681-76.079636 0-81.917327 23.403144-157.984319 76.068798-222.350642 46.835188-64.377161 117.042815-111.168999 193.106195-140.433316 29.251673 0 52.654817 17.563647 64.368129 40.954148-5.862978 5.850335-11.711506 11.711506-17.563647 11.711506 29.251673 11.700669 40.952342 35.102007 40.952342 64.366324 5.862978 163.834654-99.459299 310.121916-245.753787 351.072451z m157.996963-374.484627c-11.702475 5.850335-29.273347 17.551004-40.954148 29.264316-5.870203 0-5.870203-5.850335-5.870203-11.711506-87.778499 52.665654-146.281844 146.294487-152.114116 245.742949 0 11.711506 5.832272 52.665654 23.38147 46.835188 29.284184-11.7097 52.662042-23.423013 70.225688-46.835188 19.503523-21.441593 39.00524-42.894024 58.506958-64.344648 35.121876-46.81532 58.535857-105.320471 70.216658-163.847297 11.700669-17.55281-5.848528-29.253479-23.392307-35.103814zM122.872378 288.185419l-64.366323 29.251673c-5.839497 5.839497-11.689832 5.839497-17.540167 5.839497-5.862978 0-5.862978-11.713313-5.862978-17.540166 0-17.551004 11.713313-29.264316 29.273347-35.114651 35.103813-29.264316 70.20582-52.654817 111.158163-70.216657 17.551004 5.850335 29.264316 23.403144 35.11465 40.952341 0 17.540166 0 17.540166-81.919133 204.812282-29.249866 58.505151-52.651204 122.873281-58.523213 187.237798 0 5.852141 5.872009 17.55281 5.872009 23.412176v5.841303c-1.959745 1.948907-3.910458 3.912264-5.872009 5.861172-5.830466 0-11.700669 0-11.700669-5.861172-29.253479 0-52.663848-17.55281-58.505152-46.804482 0-46.813513 11.711506-99.470137 29.251673-140.433316 23.413982-64.366323 58.517795-122.871475 93.619802-187.237798zM637.792126 282.326054c11.700669 157.984319-87.760436 298.417635-239.892614 339.380813-29.264316 0-58.515989-5.850335-76.07783-29.264316-23.401338-17.561841-35.092976-46.813513-35.092976-76.056155 0-81.926358 23.403144-157.99335 76.068798-222.359673 46.804482-64.355486 117.008497-111.159968 193.086327-140.433316 29.242642 0 52.665654 17.551004 64.368129 40.975823-5.852141 5.839497-11.702475 11.689832-17.55281 11.689832 17.551004 17.549197 35.092976 46.811707 35.092976 76.066992z m-81.908295-35.103814c-11.7097 5.850335-29.260704 17.551004-40.963179 29.251673-5.850335 0-5.850335-5.850335-5.850335-11.700669-87.769468 52.665654-146.272813 146.28365-152.135791 245.762818 0 11.680801 5.862978 52.663848 23.413982 46.793645 29.251673-11.702475 52.665654-23.403144 70.20582-46.793645a140273.571944 140273.571944 0 0 0 58.515989-64.366324c35.103813-46.826157 58.514183-105.320471 70.214852-163.84549 11.713313-17.551004-5.839497-29.253479-23.401338-35.102008zM23.414885 808.944665c269.155125-111.170806 561.711587-169.684988 848.437584-181.3983v5.859365c29.251673 0 52.665654-5.859366 76.068798-5.859365v11.711506c-292.558269 29.26251-579.287878 87.778499-854.302368 175.544354-23.413982 11.713313-40.954148 17.554616-64.36813 23.3905h-5.837691c-5.872009 0-11.702475-5.835885-11.702475-17.551003 3.903233-3.896009 7.804661-7.797436 11.704282-11.697057z" fill="url(#left-to-right)" p-id="6741" class="logo-path"></path></svg></div><img class="h-40" src="/logo.svg"></a><div class="nav-items"><!--[--><!--[--><a href="/" class="nav-item">首页</a><!--]--><!--[--><a href="/question" class="nav-item">问答</a><!--]--><!--[--><a href="/blog" class="nav-item">博客</a><!--]--><!--[--><a href="/about" class="nav-item">关于</a><!--]--><!--[--><a href="/message" class="nav-item">留言</a><!--]--><!--[--><a class="nav-item" target="_blank" rel="noopener noreferrer" href="https://tools.winter100.com">工具箱</a><!--]--><!--]--></div><div class="flex-1"></div><div class="c-lang-legal xs:hidden"><!--[--><span class="relative ml-32 inline-flex items-center cursor-pointer border-gray-06 border px-8 py-4 rounded-8 el-tooltip__trigger el-tooltip__trigger"><img src="/images/cn.svg" class="mr-8"> 简体中文 <i class="el-icon ml-4 text-12" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="m192 384 320 384 320-384z"></path></svg><!--]--></i></span><!--teleport start--><!--teleport end--><!--]--></div><i class="iconfont icon-caidan text-theme hover:opacity-70 text-28 hidden xs:block"></i><!--]--></header><!----></div><main class="l-default-home"><!--[--><div class="c-question-main"><div class="page-container pt-30 pb-60"><div class="c-outer"><div class="article-area"><h1 class="article-title">实时将HTTP流传输到HTML5视频客户端的最佳方法</h1><p class="article-meta" style="color:#8590a6;"><i class="iconfont icon-time text-12"></i><span>猪猪小卤蛋</span><span>发布于2020/03/23 14:22:39</span></p><div class="article-content code-content"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我真的很想了解使用node.js将ffmpeg实时输出流到HTML5客户端的最佳方法，因为有很多变量在起作用，而且我在这个领域没有很多经验，花了很多小时尝试不同的组合。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的用例是：</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）IP摄像机RTSP H.264流由FFMPEG采集，并使用节点中的以下FFMPEG设置重新混合到mp4容器中，并输出到STDOUT。</font><font style="vertical-align: inherit;">这仅在初始客户端连接上运行，因此部分内容请求不会尝试再次产生FFMPEG。</font></font></p>

<pre><code>liveFFMPEG = child_process.spawn("ffmpeg", [<font></font>
                "-i", "rtsp://admin:12345@192.168.1.234:554" , "-vcodec", "copy", "-f",<font></font>
                "mp4", "-reset_timestamps", "1", "-movflags", "frag_keyframe+empty_moov", <font></font>
                "-"   // output to stdout<font></font>
                ],  {detached: false});<font></font>
</code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）我使用节点http服务器捕获STDOUT，并根据客户端请求将其流式传输回客户端。</font><font style="vertical-align: inherit;">当客户端第一次连接时，我产生了上面的FFMPEG命令行，然后将STDOUT流通过管道传递到HTTP响应。</font></font></p>

<pre><code>liveFFMPEG.stdout.pipe(resp);
</code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我还使用了stream事件将FFMPEG数据写入HTTP响应，但是没有区别</font></font></p>

<pre><code>xliveFFMPEG.stdout.on("data",function(data) {<font></font>
        resp.write(data);<font></font>
}<font></font>
</code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我使用以下HTTP标头（在流式传输预先记录的文件时也使用并起作用）</font></font></p>

<pre><code>var total = 999999999         // fake a large file<font></font>
var partialstart = 0<font></font>
var partialend = total - 1<font></font>
<font></font>
if (range !== undefined) {<font></font>
    var parts = range.replace(/bytes=/, "").split("-"); <font></font>
    var partialstart = parts[0]; <font></font>
    var partialend = parts[1];<font></font>
} <font></font>
<font></font>
var start = parseInt(partialstart, 10); <font></font>
var end = partialend ? parseInt(partialend, 10) : total;   // fake a large file if no range reques <font></font>
<font></font>
var chunksize = (end-start)+1; <font></font>
<font></font>
resp.writeHead(206, {<font></font>
                  'Transfer-Encoding': 'chunked'<font></font>
                 , 'Content-Type': 'video/mp4'<font></font>
                 , 'Content-Length': chunksize // large size to fake a file<font></font>
                 , 'Accept-Ranges': 'bytes ' + start + "-" + end + "/" + total<font></font>
});<font></font>
</code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）客户端必须使用HTML5视频标签。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我没有流传输回放的问题（使用fs.createReadStream和206 HTTP部分内容）到HTML5客户端，该视频文件以前是使用上述FFMPEG命令行记录的（但保存到文件而不是STDOUT），所以我知道FFMPEG流是正确的，当连接到HTTP节点服务器时，我什至可以在VLC中正确看到视频实时流。</font></font></p>

<p>However trying to stream live from FFMPEG via node HTTP seems to be a lot harder as the client will display one frame then stop. I suspect the problem is that I am not setting up the HTTP connection to be compatible with the HTML5 video client. I have tried a variety of things like using HTTP 206 (partial content) and 200 responses, putting the data into a buffer then streaming with no luck, so I need to go back to first principles to ensure I'm setting this up the right way.</p>

<p>Here is my understanding of how this should work, please correct me if I'm wrong:</p>

<p>1) FFMPEG should be setup to fragment the output and use an empty moov (FFMPEG frag_keyframe and empty_moov mov flags). This means the client does not use the moov atom which is typically at the end of the file which isn't relevant when streaming (no end of file), but means no seeking possible which is fine for my use case.</p>

<p>2) Even though I use MP4 fragments and empty MOOV, I still have to use HTTP partial content, as the HTML5 player will wait until the entire stream is downloaded before playing, which with a live stream never ends so is unworkable.</p>

<p>3) I don't understand why piping the STDOUT stream to the HTTP response doesn't work when streaming live yet if I save to a file I can stream this file easily to HTML5 clients using similar code. Maybe it's a timing issue as it takes a second for the FFMPEG spawn to start, connect to the IP camera and send chunks to node, and the node data events are irregular as well. However the bytestream should be exactly the same as saving to a file, and HTTP should be able to cater for delays.</p>

<p>4) When checking the network log from the HTTP client when streaming a MP4 file created by FFMPEG from the camera, I see there are 3 client requests: A general GET request for the video, which the HTTP server returns about 40Kb, then a partial content request with a byte range for the last 10K of the file, then a final request for the bits in the middle not loaded. Maybe the HTML5 client once it receives the first response is asking for the last part of the file to load the MP4 MOOV atom? If this is the case it won't work for streaming as there is no MOOV file and no end of the file.</p>

<p>5) When checking the network log when trying to stream live, I get an aborted initial request with only about 200 bytes received, then a re-request again aborted with 200 bytes and a third request which is only 2K long. I don't understand why the HTML5 client would abort the request as the bytestream is exactly the same as I can successfully use when streaming from a recorded file. It also seems node isn't sending the rest of the FFMPEG stream to the client, yet I can see the FFMPEG data in the .on event routine so it is getting to the FFMPEG node HTTP server.</p>

<p>6) Although I think piping the STDOUT stream to the HTTP response buffer should work, do I have to build an intermediate buffer and stream that will allow the HTTP partial content client requests to properly work like it does when it (successfully) reads a file? I think this is the main reason for my problems however I'm not exactly sure in Node how to best set that up. And I don't know how to handle a client request for the data at the end of the file as there is no end of file.</p>

<p>7) Am I on the wrong track with trying to handle 206 partial content requests, and should this work with normal 200 HTTP responses? HTTP 200 responses works fine for VLC so I suspect the HTML5 video client will only work with partial content requests?</p>

<p>As I'm still learning this stuff its difficult to work through the various layers of this problem (FFMPEG, node, streaming, HTTP, HTML5 video) so any pointers will be greatly appreciated. I have spent hours researching on this site and the net, and I have not come across anyone who has been able to do real time streaming in node but I can't be the first, and I think this should be able to work (somehow!).</p></div></div><div class="mt-20"><div class="discuss-wrapper"><div class="discuss-list"><!--[--><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">阳光梅L</span><span class="discuss-time">2020/03/23 14:22:40</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个非常普遍的误解。</font><font style="vertical-align: inherit;">没有实时HTML5视频支持（iOS和Mac Safari上的HLS除外）。</font><font style="vertical-align: inherit;">您也许可以使用webm容器来“破解”它，但是我不希望它得到普遍支持。</font><font style="vertical-align: inherit;">您要查找的内容包含在Media Source Extensions中，您可以在其中一次将片段提供给浏览器。</font><font style="vertical-align: inherit;">但是您将需要编写一些客户端javascript。</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">LGil</span><span class="discuss-time">2020/03/23 14:22:40</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">试试binaryjs。</font><font style="vertical-align: inherit;">它就像socket.io一样，但它唯一能做的就是播放音频视频。</font><font style="vertical-align: inherit;">Binaryjs谷歌它</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">宝儿</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用jpeg解决方案，只是让服务器将jpeg一张一张地分发到浏览器，然后使用canvas元素绘制这些jpeg？
</font></font><a href="http://thejackalofjavascript.com/rpi-live-streaming/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://thejackalofjavascript.com/rpi-live-streaming/</font></font></a></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">神奇JinJin</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我围绕百老汇h264编解码器（脚本）编写了HTML5视频播放器，该播放器可以在所有浏览器（台式机，iOS等）上实时播放（无延迟）h264视频。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视频流通过websocket发送到客户端，每帧解码后的帧并显示在画布中（使用webgl进行加速）</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在github上</font><font style="vertical-align: inherit;">查看</font></font><a href="https://github.com/131/h264-live-player" rel="noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/131/h264-live-player</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">老丝</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谢谢大家，特别是szatmary，因为这是一个复杂的问题，涉及很多层，所有这些层都必须先工作，然后才能流式传输实时视频。</font><font style="vertical-align: inherit;">为了阐明我的原始问题和HTML5视频使用与Flash的关系-我的用例非常喜欢HTML5，因为它是通用的，易于在客户端和将来实现。</font><font style="vertical-align: inherit;">Flash是遥遥领先的第二好选择，因此我们坚持使用HTML5解决这个问题。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过这个练习，我学到了很多东西，并且同意直播比VOD难得多（这对HTML5视频很有效）。</font><font style="vertical-align: inherit;">但是在我的用例中，确实做到了这一点，令人满意的解决方案在解决了诸如MSE，Flash，Node中精心设计的缓冲方案等更复杂的选项之后，解决方案非常简单。</font><font style="vertical-align: inherit;">问题在于FFMPEG破坏了碎片化的MP4，我不得不调整FFMPEG参数，而我最初使用的HTTP上的标准节点流管道重定向就是所需要的。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MP4中，有一个“片段化”选项，可将mp4分成更小的片段，这些片段具有自己的索引，并使mp4实时流式传输选项可行。</font><font style="vertical-align: inherit;">但是不可能找回流（对于我的用例来说还可以），并且更高版本的FFMPEG支持分段。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意时间安排可能是一个问题，在我的解决方案中，由于重混合的原因，我有2到6秒的延迟（有效的FFMPEG必须接收实时流，将其重新混合，然后将其发送到节点以通过HTTP服务） 。</font><font style="vertical-align: inherit;">无法对此做很多事情，但是在Chrome中，视频确实会尽一切可能赶上来，这使视频有点跳动，但比IE11（我的首选客户端）更新了。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了在本文中解释代码的工作方式之外，还请查看带有注释的GIST（不包括客户端代码，它是带有节点http服务器地址的标准HTML5视频标记）。</font><font style="vertical-align: inherit;">GIST在这里：</font><a href="https://gist.github.com/deandob/9240090" rel="noreferrer"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://gist.github.com/deandob/9240090" rel="noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//gist.github.com/deandob/9240090</font></font></a> </p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我无法找到该用例的类似示例，因此我希望上面的解释和代码对其他人有所帮助，特别是因为我从该站点中学到了很多，并且仍然认为自己是初学者！ </font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管这是我特定问题的答案，但我选择了szatmary的答案作为公认的答案，因为它是最全面的答案。</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">小胖</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看看</font></font><a href="http://www.pr.com/press-release/605764" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个解决方案</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">据我所知，Flashphoner允许在纯HTML5页面中播放实时音频和视频流。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们使用</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MPEG1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G.711</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编解码器进行播放。</font><font style="vertical-align: inherit;">黑客将解码后的视频呈现到HTML5 canvas元素，并通过HTML5音频上下文播放解码后的音频。</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">老丝阿飞</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将基于RTSP的网络摄像头实时流传输到HTML5客户端的一种方法（涉及重新编码，因此会导致质量损失，并且需要一些CPU能力）：</font></font></p>

<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置一个Icecast服务器（可以与Web服务器位于同一台计算机上，也可以位于从cam接收RTSP流的计算机上）</font></font></li>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从摄像机接收流的机器上，不要使用FFMPEG，而要使用gstreamer。</font><font style="vertical-align: inherit;">它能够接收和解码RTSP流，对其进行重新编码并将其流传输到Icecast服务器。</font><font style="vertical-align: inherit;">管道示例（仅视频，无音频）：</font></font></p>

<pre><code>gst-launch-1.0 rtspsrc location=rtsp://192.168.1.234:554 user-id=admin user-pw=123456 ! rtph264depay ! avdec_h264 ! vp8enc threads=2 deadline=10000 ! webmmux streamable=true ! shout2send password=pass ip=&lt;IP_OF_ICECAST_SERVER&gt; port=12000 mount=cam.webm
</code></pre></li>
</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;然后，您可以将&lt;video&gt;标记与icecast-stream的URL（</font></font><a href="http://127.0.0.1:12000/cam.webm" rel="noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://127.0.0.1:12000/cam.webm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）一起使用，它将在支持webm的所有浏览器和设备中运行</font></font></p></div><!----></div></div><div class="discuss-item"><div class="discuss-parent"><div class="discuss-meta"><span class="discuss-user">Mandy</span><span class="discuss-time">2020/03/23 14:22:39</span></div><div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看一下</font></font><a href="https://github.com/phoboslab/jsmpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSMPEG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目。</font><font style="vertical-align: inherit;">在那里实现了一个好主意-使用JavaScript在浏览器中解码MPEG。</font><font style="vertical-align: inherit;">例如，可以使用WebSockets或Flash将来自编码器（例如FFMPEG）的字节传输到浏览器。</font><font style="vertical-align: inherit;">我认为，如果社区能够赶上潮流，它将是目前最好的HTML5实时视频流解决方案。</font></font></p></div><!----></div></div><!--]--></div></div></div><div class="c-block-comment"><script>window.blockCommentOptions = {
    root: &#39;discuss-wrapper&#39;,
    lang: &#39;zh_Hans_CN&#39;,
    locale: {&quot;discussTip&quot;:&quot;您的回答将提交至区块链中，开启Web3的大门。&quot;,&quot;discussInputTitle&quot;:&quot;回答&quot;,&quot;discussInputCommentPlaceholder&quot;:&quot;请输入回答...&quot;,&quot;discussInputCommentTip&quot;:&quot;请输入回答&quot;,&quot;discussSubmitting&quot;:&quot;您的回答正提交至区块链中...&quot;,&quot;totalTitle&quot;:&quot;共[num]条回答&quot;},
  };</script><script async src="/assets/js/block-comment.js"></script></div></div><div class="c-aside"><div class="fixed-area"><div class="question-list"><p class="title">最新问答</p><div class="body"><!--[--><div class="a-list-item"><a href="/question/4376" class=""><div class="inner-item"><!----><span class="flex-1">HTML5 Drag &amp; Drop 拖动时更改图标/光标</span></div><div class="text-12 text-theme mt-4">5 <span>回答</span></div></a></div><div class="a-list-item"><a href="/question/4375" class=""><div class="inner-item"><!----><span class="flex-1">如何完全卸载 Node.js，然后从头重新安装 (Mac OS X)</span></div><div class="text-12 text-theme mt-4">25 <span>回答</span></div></a></div><div class="a-list-item"><a href="/question/4342" class=""><div class="inner-item"><!----><span class="flex-1">MAC终端删除代理有效命令</span></div><div class="text-12 text-theme mt-4">1 <span>回答</span></div></a></div><div class="a-list-item"><a href="/question/4338" class=""><div class="inner-item"><!----><span class="flex-1">vue动态路由跳转同一地址不刷新页面</span></div><div class="text-12 text-theme mt-4">0 <span>回答</span></div></a></div><div class="a-list-item"><a href="/question/4336" class=""><div class="inner-item"><!----><span class="flex-1">NUXT引入tailwindcss报错Error: Expected an opening square bracket.</span></div><div class="text-12 text-theme mt-4">1 <span>回答</span></div></a></div><!--]--></div></div><div class="c-adsense side-adsense"><div class="ad-container"><!--[--><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9684175232031230" crossorigin="anonymous"></script><ins class="adsbygoogle" style="display:block;" data-ad-client="ca-pub-9684175232031230" data-ad-slot="2002754568" data-ad-format="auto" data-full-width-responsive="true"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><!--]--></div></div></div></div></div></div><!--]--></main><div class="c-footer"><div class="common-footer-inner"><div class="logo-contract"><a href="/" class="inline-flex space-x-8 items-center"><div class="sub-logo"><svg t="1696732448231" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6740" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><defs><linearGradient id="left-to-right"><stop offset="0" stop-color="#ed3da1"><animate dur="3s" attributeName="offset" fill="freeze" values="-1;2;0" repeatCount="indefinite"></animate></stop><stop offset="0" stop-color="#ffe9f6"><animate dur="3s" attributeName="offset" fill="freeze" values="-1;2;0" repeatCount="indefinite"></animate></stop></linearGradient></defs><path d="M105.321374 914.265136c-11.700669 0-17.551004-11.702475-17.551003-17.541972 0-5.870203 5.850335-17.551004 11.7097-17.551004 269.155125-111.194286 561.722425-169.684988 848.441196-181.3983v5.839497c23.410369 0 52.662042-5.839497 76.076024-5.839497v11.711506c-292.558269 29.251673-579.284266 87.756824-854.300562 175.535323-17.551004 17.541972-40.964985 23.403144-64.375355 29.244447zM772.382332 580.741882c-29.260704 0-58.514183-5.861172-76.054349-29.240835-17.55281-23.412175-35.123682-46.826157-35.123681-76.079636 0-81.917327 23.403144-157.984319 76.068798-222.350642 46.835188-64.377161 117.042815-111.168999 193.106195-140.433316 29.251673 0 52.654817 17.563647 64.368129 40.954148-5.862978 5.850335-11.711506 11.711506-17.563647 11.711506 29.251673 11.700669 40.952342 35.102007 40.952342 64.366324 5.862978 163.834654-99.459299 310.121916-245.753787 351.072451z m157.996963-374.484627c-11.702475 5.850335-29.273347 17.551004-40.954148 29.264316-5.870203 0-5.870203-5.850335-5.870203-11.711506-87.778499 52.665654-146.281844 146.294487-152.114116 245.742949 0 11.711506 5.832272 52.665654 23.38147 46.835188 29.284184-11.7097 52.662042-23.423013 70.225688-46.835188 19.503523-21.441593 39.00524-42.894024 58.506958-64.344648 35.121876-46.81532 58.535857-105.320471 70.216658-163.847297 11.700669-17.55281-5.848528-29.253479-23.392307-35.103814zM122.872378 288.185419l-64.366323 29.251673c-5.839497 5.839497-11.689832 5.839497-17.540167 5.839497-5.862978 0-5.862978-11.713313-5.862978-17.540166 0-17.551004 11.713313-29.264316 29.273347-35.114651 35.103813-29.264316 70.20582-52.654817 111.158163-70.216657 17.551004 5.850335 29.264316 23.403144 35.11465 40.952341 0 17.540166 0 17.540166-81.919133 204.812282-29.249866 58.505151-52.651204 122.873281-58.523213 187.237798 0 5.852141 5.872009 17.55281 5.872009 23.412176v5.841303c-1.959745 1.948907-3.910458 3.912264-5.872009 5.861172-5.830466 0-11.700669 0-11.700669-5.861172-29.253479 0-52.663848-17.55281-58.505152-46.804482 0-46.813513 11.711506-99.470137 29.251673-140.433316 23.413982-64.366323 58.517795-122.871475 93.619802-187.237798zM637.792126 282.326054c11.700669 157.984319-87.760436 298.417635-239.892614 339.380813-29.264316 0-58.515989-5.850335-76.07783-29.264316-23.401338-17.561841-35.092976-46.813513-35.092976-76.056155 0-81.926358 23.403144-157.99335 76.068798-222.359673 46.804482-64.355486 117.008497-111.159968 193.086327-140.433316 29.242642 0 52.665654 17.551004 64.368129 40.975823-5.852141 5.839497-11.702475 11.689832-17.55281 11.689832 17.551004 17.549197 35.092976 46.811707 35.092976 76.066992z m-81.908295-35.103814c-11.7097 5.850335-29.260704 17.551004-40.963179 29.251673-5.850335 0-5.850335-5.850335-5.850335-11.700669-87.769468 52.665654-146.272813 146.28365-152.135791 245.762818 0 11.680801 5.862978 52.663848 23.413982 46.793645 29.251673-11.702475 52.665654-23.403144 70.20582-46.793645a140273.571944 140273.571944 0 0 0 58.515989-64.366324c35.103813-46.826157 58.514183-105.320471 70.214852-163.84549 11.713313-17.551004-5.839497-29.253479-23.401338-35.102008zM23.414885 808.944665c269.155125-111.170806 561.711587-169.684988 848.437584-181.3983v5.859365c29.251673 0 52.665654-5.859366 76.068798-5.859365v11.711506c-292.558269 29.26251-579.287878 87.778499-854.302368 175.544354-23.413982 11.713313-40.954148 17.554616-64.36813 23.3905h-5.837691c-5.872009 0-11.702475-5.835885-11.702475-17.551003 3.903233-3.896009 7.804661-7.797436 11.704282-11.697057z" fill="url(#left-to-right)" p-id="6741" class="logo-path"></path></svg></div><img class="h-50" src="/logo.svg"></a><div class="contacts"><!--[--><a class="contact-item" href="mailto:yldiswinter@gmail.com"><i class="iconfont icon-youxiang"></i></a><a class="contact-item" href="https://github.com/WinterMain"><i class="iconfont icon-github"></i></a><!--]--></div></div><div class="nav-area"><div class="pr-20"><p class="label"><span class="z-1">导航</span></p></div><div class="nav-items"><!--[--><!--[--><a href="/question" class="nav-item">问答</a><!--]--><!--[--><a href="/blog" class="nav-item">博客</a><!--]--><!--[--><a href="/message" class="nav-item">留言</a><!--]--><!--[--><a class="nav-item" target="_blank" rel="noopener noreferrer" href="https://tools.winter100.com">工具箱</a><!--]--><!--]--></div></div><div class="donate-area"><div class="pr-20"><p class="label"><span class="z-1">打赏</span></p></div><div class="donate-list"><!--[--><div class="donate-item"><div class="c-common-qrcode"><canvas style="width:60px;height:60px;"></canvas></div><div class="ml-12"><div class="flex items-center mt-4"><img src="/images/btc.png" height="30" class="h-20"><span class="ml-8 text-primary font-w500 text-16 flex-1">BTC</span><!--[--><span class="c-copy el-tooltip__trigger el-tooltip__trigger"><i class="el-icon text-12" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64z"></path><path fill="currentColor" d="M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64"></path></svg><!--]--></i></span><!--teleport start--><!--teleport end--><!--]--></div><p class="mt-12 text-addr"><span class="">1Q6ZDFC3FueXY3JocmeMqgiSsGGtppbvz2</span></p></div></div><div class="donate-item"><div class="c-common-qrcode"><canvas style="width:60px;height:60px;"></canvas></div><div class="ml-12"><div class="flex items-center mt-4"><img src="/images/eth.png" height="30" class="h-20"><span class="ml-8 text-primary font-w500 text-16 flex-1">ETH</span><!--[--><span class="c-copy el-tooltip__trigger el-tooltip__trigger"><i class="el-icon text-12" style=""><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64z"></path><path fill="currentColor" d="M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64"></path></svg><!--]--></i></span><!--teleport start--><!--teleport end--><!--]--></div><p class="mt-12 text-addr"><span class="">0xff6FC30033269845d196cB48F6a0660598D218D8</span></p></div></div><!--]--></div></div><div class="flex-1 ml-20 flex justify-end xs:hidden"><div class="c-adsense mt-0"><div class="ad-container"><!--[--><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9684175232031230" crossorigin="anonymous"></script><ins class="adsbygoogle" style="display:block;width:180px;height:180px" data-ad-client="ca-pub-9684175232031230" data-ad-slot="6637798878"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><!--]--></div></div></div></div></div><!--v-if--><!--]--></section><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr id="__NUXT_DATA__" data-src="/question/2856/_payload.json?47ab0edb-15e7-4bcc-8c17-4ee0b46c6aa8">[{"state":1,"once":7,"_errors":8,"serverRendered":10,"path":11,"pinia":12,"prerenderedAt":43},["Reactive",2],{"$ssite-config":3},{"env":4,"name":5,"url":6},"production","Winter 100分","https://winter100.com/",["Set"],["ShallowReactive",9],{},true,"/question/2856",["Reactive",13],{"lang":14,"main":27},{"langOptions":15,"lang":17,"defaultLang":17},[16,20,23],{"val":17,"text":18,"icon":19},"zh_Hans_CN","简体中文","/images/cn.svg",{"val":21,"text":22,"icon":19},"zh_Hant_HK","繁体中文",{"val":24,"text":25,"icon":26},"en_US","English","/images/en.svg",{"category":28,"nav":29,"likes":30,"donateCoins":31},"browserplugin","all",[],[32,36,40],{"coin":33,"address":34,"icon":35},"BTC","1Q6ZDFC3FueXY3JocmeMqgiSsGGtppbvz2","/images/btc.png",{"coin":37,"address":38,"icon":39},"ETH","0xff6FC30033269845d196cB48F6a0660598D218D8","/images/eth.png",{"coin":41,"address":38,"icon":42},"CET","/images/cet.png",1728822618466]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{MODE:"",NODE_ENV:"production",NAME:"winter100"},app:{baseURL:"/",buildId:"47ab0edb-15e7-4bcc-8c17-4ee0b46c6aa8",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>